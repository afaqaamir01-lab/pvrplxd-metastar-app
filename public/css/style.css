/* --- 1. CONFIGURATION & VARIABLES --- */
:root {
    /* -- COLORS -- */
    --bg-app: #030303;
    --glass-panel: #0a0a0a; 
    --glass-border: #1f1f1f;
    --glass-highlight: rgba(255, 255, 255, 0.08);
    
    /* -- ACCENTS -- */
    --accent: #dfff00;
    --accent-hover: #eaff33;
    --accent-dim: rgba(223, 255, 0, 0.05);
    
    /* -- SEMANTICS -- */
    --text-main: #ffffff;
    --text-muted: #888888;
    --danger: #ff4444;
    --warning: #ffcc00;
    --success: #00ff88;

    /* -- DIMENSIONS -- */
    --sidebar-width: 320px;
    --sidebar-margin: 24px;
    --radius-sm: 6px;
    --radius-md: 12px;
    --radius-lg: 20px;
    
    /* -- Z-INDEX SCALE -- */
    --z-canvas: 1;
    --z-ui: 100;      /* Sidebar, Badges */
    --z-fab: 200;     /* Floating Actions */
    --z-modal: 1000;  /* Auth Overlay */
    --z-loader: 9999; /* Black Curtain */

    /* -- ANIMATION -- */
    --ease-out: cubic-bezier(0.2, 0.8, 0.2, 1);
}

/* --- 2. GLOBAL RESET --- */
*, *::before, *::after { 
    box-sizing: border-box; 
    outline: none; 
    -webkit-tap-highlight-color: transparent; 
}

body {
    margin: 0;
    background: var(--bg-app);
    background-image: radial-gradient(circle at 50% 30%, #111 0%, #000 100%);
    color: var(--text-main);
    font-family: 'Space Grotesk', system-ui, -apple-system, sans-serif;
    height: 100dvh; 
    overflow: hidden;
    user-select: none;
}

/* --- 3. AUTHENTICATION TERMINAL --- */
.overlay { 
    position: fixed; inset: 0; 
    z-index: var(--z-modal);
    background: #000; 
    display: flex; align-items: center; justify-content: center; 
    padding: 20px; 
}

.auth-container { 
    width: 100%; max-width: 360px;
    background: var(--glass-panel); 
    border: 1px solid var(--glass-border); 
    border-radius: var(--radius-lg); 
    box-shadow: 0 40px 100px rgba(0,0,0,0.9);
    
    display: flex; flex-direction: column;
    padding: 32px 28px;
    position: relative; overflow: hidden;
    
    /* Performance */
    contain: content;
    will-change: height, transform; 
    transition: height 0.3s var(--ease-out);
}

.auth-header { text-align: center; margin-bottom: 24px; flex-shrink: 0; }
.logo-text { font-size: 20px; font-weight: 700; letter-spacing: 3px; color: #fff; margin-bottom: 6px; }
.terminal-status { color: var(--text-muted); font-size: 10px; font-family: monospace; letter-spacing: 1px; text-transform: uppercase; opacity: 0.7; }

/* States */
.auth-state { display: none; flex-direction: column; width: 100%; animation: slideUp 0.3s var(--ease-out); }
.auth-state.active { display: flex; }
.auth-state.hidden { display: none !important; }

@keyframes slideUp {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Auth Inputs */
.input-wrapper { position: relative; margin-bottom: 16px; width: 100%; }
.modern-input { 
    width: 100%; background: #0f0f0f; border: 1px solid #2a2a2a; 
    padding: 14px 14px 14px 44px; border-radius: var(--radius-md); 
    color: #fff; font-size: 14px; font-family: inherit; transition: all 0.2s; 
}
.modern-input:focus { border-color: #555; background: #000; }
.input-icon { 
    position: absolute; left: 16px; top: 50%; transform: translateY(-50%); 
    color: #444; pointer-events: none; transition: color 0.2s; 
    width: 16px; height: 16px; 
}
.modern-input:focus + .input-icon { color: #fff; }

/* Buttons */
.primary-btn { 
    width: 100%; padding: 14px; margin-top: 8px;
    background: var(--accent); color: #000; 
    border: none; border-radius: var(--radius-md); 
    font-weight: 700; font-size: 13px; letter-spacing: 0.5px; text-transform: uppercase;
    cursor: pointer; position: relative; overflow: hidden;
    display: flex; justify-content: center; align-items: center;
    transition: transform 0.1s, background-color 0.2s;
}
.primary-btn:hover { background-color: var(--accent-hover); transform: translateY(-1px); }
.primary-btn:active { transform: scale(0.98); }
.btn-purchase { background: #fff; color: #000; }
.btn-purchase:hover { background: #eee; }

.btn-loader { 
    display: none; width: 16px; height: 16px; 
    border: 2px solid rgba(0,0,0,0.1); border-top-color: #000; 
    border-radius: 50%; animation: spin 0.8s linear infinite; position: absolute; 
}
@keyframes spin { to { transform: rotate(360deg); } }

/* OTP & Feedback */
.otp-group { display: flex; gap: 8px; justify-content: center; margin-bottom: 16px; }
.otp-digit { 
    width: 40px; height: 50px; background: #111; border: 1px solid #2a2a2a; 
    border-radius: var(--radius-sm); color: #fff; font-size: 20px; font-weight: 500; 
    text-align: center; transition: 0.2s; caret-color: var(--accent); 
}
.otp-digit:focus { border-color: var(--accent); background: #000; }

.icon-stage { 
    width: 56px; height: 56px; border-radius: 50%; margin: 0 auto 16px auto;
    display: flex; align-items: center; justify-content: center; 
    background: #111; border: 1px solid #222;
}
.icon-stage svg { width: 24px; height: 24px; }
.icon-stage.success { color: var(--success); border-color: rgba(0,255,136,0.3); background: rgba(0,255,136,0.05); }
.icon-stage.warning { color: var(--warning); border-color: rgba(255,204,0,0.3); background: rgba(255,204,0,0.05); }
.icon-stage.danger { color: var(--danger); border-color: rgba(255,68,68,0.3); background: rgba(255,68,68,0.05); }

/* --- 4. CORE APPLICATION UI --- */
#main-ui { position: relative; width: 100%; height: 100%; visibility: hidden; }

/* Canvas Area */
#viewport { 
    position: absolute; inset: 0; z-index: var(--z-canvas);
    background: var(--bg-app); 
    touch-action: none; /* Crucial for JS Dragging */
    contain: layout paint; /* Optimization */
}
canvas { display: block; width: 100%; height: 100%; }

/* Sidebar Container */
#sidebar {
    position: absolute; top: 50%; left: var(--sidebar-margin); 
    width: var(--sidebar-width); max-height: 85vh;
    transform: translateY(-50%) translateZ(0); 
    z-index: var(--z-ui);
    
    background: rgba(12, 12, 14, 0.75); 
    backdrop-filter: blur(50px); -webkit-backdrop-filter: blur(50px);
    border: 1px solid var(--glass-border); 
    box-shadow: inset 0 0 0 1px rgba(255,255,255,0.05), 0 24px 60px rgba(0,0,0,0.6);
    border-radius: var(--radius-lg); 
    
    display: flex; flex-direction: column;
    contain: layout; /* Isolate layout calcs */
}

.sidebar-header { 
    padding: 24px 24px 18px; 
    display: flex; justify-content: space-between; align-items: center; 
    flex-shrink: 0; 
}
.brand { font-weight: 700; font-size: 14px; letter-spacing: 1px; color: #fff; text-transform: uppercase; }

.sidebar-content { 
    overflow-y: auto; padding: 0 24px 24px; 
    scrollbar-width: none; 
    display: flex; flex-direction: column; gap: 24px; /* Use Gap instead of Margins */
}
.sidebar-content::-webkit-scrollbar { display: none; }

/* Control Groups */
.control-section { display: flex; flex-direction: column; gap: 16px; }
.section-label { 
    font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 1.2px; 
    color: #666; display: flex; align-items: center; gap: 8px; 
}
.control-row { display: flex; align-items: center; justify-content: space-between; min-height: 24px; }
.control-row > label { 
    font-size: 13px; color: #ccc; font-weight: 500; 
    width: 85px; min-width: 85px; flex-shrink: 0; 
}

/* Sliders & Inputs */
.slider-group { display: flex; align-items: center; gap: 12px; flex: 1; margin-left: 12px; }
input[type=range] { 
    -webkit-appearance: none; width: 100%; height: 4px; 
    background: #333; border-radius: 4px; cursor: pointer; 
    touch-action: none; /* Prevents scroll while dragging slider */
}
input[type=range]::-webkit-slider-thumb { 
    -webkit-appearance: none; width: 16px; height: 16px; 
    border-radius: 50%; background: #fff; 
    box-shadow: 0 2px 6px rgba(0,0,0,0.5); cursor: grab; transition: transform 0.1s; margin-top: -6px;
    will-change: transform; 
}
input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.2); }

input[type=number] { 
    width: 48px; background: #1a1a1a; border: 1px solid #333; 
    color: #fff; font-size: 12px; padding: 6px; border-radius: var(--radius-sm); 
    text-align: center; -moz-appearance: textfield; transition: all 0.2s; 
}
input[type=number]:focus { border-color: #666; background: #000; }

input[type=color] { 
    -webkit-appearance: none; border: 2px solid #333; width: 32px; height: 32px; 
    border-radius: 50%; padding: 0; cursor: pointer; background: none; transition: transform 0.2s; 
}
input[type=color]:hover { transform: scale(1.1); border-color: #555; }
input[type=color]::-webkit-color-swatch { border: none; border-radius: 50%; }

/* Toggles */
.toggle-wrapper { position: relative; width: 44px; height: 24px; }
.ios-toggle { opacity: 0; width: 0; height: 0; position: absolute; }
.toggle-btn { 
    position: absolute; cursor: pointer; inset: 0; 
    background-color: #2a2a2a; transition: .3s; border-radius: 999px; border: 1px solid #333; 
}
.toggle-btn:before { 
    position: absolute; content: ""; height: 20px; width: 20px; left: 1px; bottom: 1px; 
    background-color: #888; transition: .3s; border-radius: 50%; 
}
.ios-toggle:checked + .toggle-btn { background-color: rgba(223, 255, 0, 0.15); border-color: var(--accent); }
.ios-toggle:checked + .toggle-btn:before { transform: translateX(20px); background-color: var(--accent); }

/* Footer */
.sidebar-footer { 
    padding: 20px; background: rgba(0,0,0,0.3); border-radius: var(--radius-md); 
    border: 1px solid rgba(255,255,255,0.08); font-size: 11px; color: #666; line-height: 1.5; 
}
.version-pill { 
    display: inline-block; margin-top: 8px; padding: 4px 8px; 
    background: #111; border: 1px solid #333; border-radius: 6px; 
    color: #fff; font-size: 10px; font-weight: 700; 
}

/* --- 5. FLOATING ACTIONS --- */
.fab-container { position: absolute; top: 24px; right: 24px; z-index: var(--z-fab); }
.fab { 
    width: 48px; height: 48px; background: var(--glass-panel); 
    backdrop-filter: blur(20px); border: 1px solid var(--glass-border); 
    color: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; 
    cursor: pointer; transition: all 0.2s ease; 
}
.fab:hover { transform: scale(1.05); background: rgba(255,255,255,0.1); }

.export-menu { 
    position: absolute; top: 60px; right: 0; width: 200px; 
    background: #111; border: 1px solid #222; border-radius: var(--radius-md); 
    padding: 8px; display: none; flex-direction: column; gap: 4px; 
    box-shadow: 0 20px 60px rgba(0,0,0,0.8); 
}
.menu-item { 
    background: transparent; border: none; color: #aaa; padding: 12px 16px; 
    font-size: 13px; border-radius: 8px; cursor: pointer; text-align: left; transition: all 0.1s; 
}
.menu-item:hover { background: #222; color: #fff; }
.menu-item.highlight { color: var(--accent); }

/* Badges */
.zoom-badge { 
    position: absolute; bottom: 32px; left: 32px; z-index: var(--z-ui);
    background: rgba(0,0,0,0.6); backdrop-filter: blur(10px); 
    border: 1px solid rgba(255,255,255,0.08); padding: 10px 16px; 
    border-radius: 50px; font-size: 12px; font-weight: 500; 
    display: flex; gap: 8px; align-items: center; color: #fff; pointer-events: none; 
}
.credit-badge { 
    position: absolute; bottom: 32px; right: 32px; z-index: var(--z-ui); 
    background: #ffffff; color: #000000; padding: 12px 24px; 
    border-radius: 100px; text-decoration: none; font-size: 11px; font-weight: 800; 
    text-transform: uppercase; letter-spacing: 1.5px; 
    transition: transform 0.2s; 
}
.credit-badge:hover { transform: translateY(-4px); }

/* --- 6. MOBILE RESPONSIVE (SHEET LOGIC) --- */
#sheet-handle { display: none; }

@media (max-width: 768px) {
    :root { --sidebar-width: 100%; --sidebar-margin: 0; }
    
    #sidebar { 
        position: fixed; top: auto; bottom: 0; left: 0; right: 0; 
        width: 100%; height: auto; max-height: 85vh; 
        transform: translateY(calc(100% - 70px)); /* Initial Closed State */
        border-radius: 32px 32px 0 0; border: 1px solid #222; border-bottom: none; 
        background: rgba(12, 12, 14, 0.95); backdrop-filter: blur(40px);
        padding-bottom: calc(24px + env(safe-area-inset-bottom)); 
        transition: none; /* JS handles dragging */
        will-change: transform;
    }

    .sidebar-header { 
        cursor: grab; position: relative; padding-top: 30px; 
        touch-action: none; /* Crucial for sheet dragging */
    }
    
    #sheet-handle { 
        display: block; position: absolute; top: 12px; left: 50%; transform: translateX(-50%); 
        width: 40px; height: 5px; background: #333; border-radius: 10px; 
    }
    
    .zoom-badge { bottom: 100px; left: 24px; }
    .fab-container { top: 20px; right: 20px; }
    .credit-badge { display: none; } 
    
    /* Hide scrollbars on mobile sidebar */
    .sidebar-content { padding-bottom: 50px; }
}

/* --- 7. LOADERS --- */
#core-loader { 
    position: fixed; inset: 0; background: #000; z-index: var(--z-loader); 
    display: flex; align-items: center; justify-content: center; 
    transition: opacity 0.8s ease-in-out, visibility 0.8s; 
}
#core-loader.loaded { opacity: 0; visibility: hidden; pointer-events: none; }

.loader-spinner { 
    width: 40px; height: 40px; border: 3px solid rgba(255, 255, 255, 0.1); 
    border-top-color: var(--accent); border-radius: 50%; 
    animation: spin 0.8s cubic-bezier(0.6, 0.2, 0.4, 0.8) infinite; 
}
